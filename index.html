<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>枫枫电竞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 精简高级风格 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-color: #ff3366;
            --secondary-color: #4dabf7;
            --success-color: #40c057;
            --warning-color: #ffcc00;
            --bg-dark: #0a0a0f;
            --bg-card: rgba(20, 20, 35, 0.95);
            --text-light: #f5f5f7;
            --text-gray: #8a8a9c;
            --border-color: rgba(255, 255, 255, 0.08);
            --shadow-color: rgba(0, 0, 0, 0.3);
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-dark) 0%, #121225 100%);
            color: var(--text-light);
            min-height: 100vh;
            padding: 12px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        /* 头部 */
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 0;
            position: relative;
        }
        
        h1 {
            color: var(--text-light);
            font-size: 1.4rem;
            font-weight: 600;
            letter-spacing: -0.3px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .club-name {
            color: var(--primary-color);
            font-weight: 700;
        }
        
        .subtitle {
            color: var(--text-gray);
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .current-time {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 8px 12px;
            margin: 12px auto;
            width: fit-content;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }
        
        .current-time span {
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        /* 标签页 */
        .mobile-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 3px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px 8px;
            border: none;
            background: transparent;
            color: var(--text-gray);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-height: 36px;
        }
        
        .tab-btn.active {
            background: rgba(255, 51, 102, 0.15);
            color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(255, 51, 102, 0.2);
        }
        
        .order-count {
            background: var(--primary-color);
            color: white;
            font-size: 0.7rem;
            padding: 1px 5px;
            border-radius: 10px;
            margin-left: 4px;
        }
        
        /* 卡片设计 */
        .card {
            background: var(--bg-card);
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 8px 24px var(--shadow-color);
            border: 1px solid var(--border-color);
            margin-bottom: 16px;
            backdrop-filter: blur(20px);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            color: var(--secondary-color);
            font-size: 1rem;
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }
        
        .card-title i {
            margin-right: 8px;
            font-size: 0.9rem;
        }
        
        /* 表单控件 */
        .input-group {
            margin-bottom: 14px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-light);
            font-weight: 500;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .optional {
            color: var(--text-gray);
            font-weight: normal;
            font-size: 0.75rem;
            margin-left: 4px;
        }
        
        .required {
            color: var(--primary-color);
            font-size: 0.8rem;
        }
        
        input, select {
            width: 100%;
            padding: 11px 14px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 0.9rem;
            transition: all 0.2s;
            -webkit-appearance: none;
            appearance: none;
        }
        
        /* 优化的时间输入布局 */
        .time-input-wrapper {
            position: relative;
            margin-bottom: 5px;
        }
        
        .time-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .time-input-group input[type="datetime-local"] {
            flex: 1;
            min-width: 0;
            font-size: 15px !important;
            padding: 12px 14px !important;
            min-height: 48px !important;
            line-height: 1.4;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%238a8a9c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 20px;
            padding-right: 45px !important;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }
        
        .time-input-group input[type="datetime-local"]:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(77, 171, 247, 0.2);
            outline: none;
        }
        
        .time-btn-group {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .time-btn-small {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-gray);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            min-height: 36px;
            flex: 1;
            min-width: 0;
        }
        
        .time-btn-small:hover, .time-btn-small:active {
            background: rgba(77, 171, 247, 0.1);
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }
        
        .time-btn-small i {
            font-size: 0.8rem;
        }
        
        /* 精简的价格按钮 */
        .price-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 7px;
            margin-bottom: 10px;
        }
        
        .price-btn {
            padding: 9px 5px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-height: 36px;
        }
        
        .price-btn:hover, .price-btn:active {
            background: rgba(77, 171, 247, 0.1);
            border-color: var(--secondary-color);
        }
        
        .price-btn.selected {
            background: rgba(77, 171, 247, 0.15);
            border-color: var(--secondary-color);
            color: var(--secondary-color);
            box-shadow: 0 2px 8px rgba(77, 171, 247, 0.2);
        }
        
        /* 按钮设计 */
        .btn {
            padding: 11px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            margin-bottom: 8px;
            min-height: 42px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #ff5588);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 51, 102, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.06);
            color: white;
            border: 1px solid var(--border-color);
        }
        
        .btn-add {
            background: linear-gradient(135deg, var(--success-color), #52cc67);
            color: white;
            box-shadow: 0 4px 12px rgba(64, 192, 87, 0.3);
        }
        
        .btn-time {
            background: linear-gradient(135deg, var(--secondary-color), #5ab3ff);
            color: white;
            box-shadow: 0 4px 12px rgba(77, 171, 247, 0.3);
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        /* 结果区域 */
        .results {
            margin-top: 18px;
            background: rgba(0, 0, 0, 0.2);
            padding: 14px;
            border-radius: 10px;
            border-left: 3px solid var(--primary-color);
        }
        
        .results h3 {
            color: var(--warning-color);
            margin-bottom: 10px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
            font-size: 0.9rem;
        }
        
        .result-value {
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        /* 响应式设计 */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .card {
                padding: 16px;
            }
            
            .time-input-group input[type="datetime-local"] {
                font-size: 14px !important;
                padding: 10px 12px !important;
                min-height: 44px !important;
                padding-right: 40px !important;
            }
            
            .time-btn-small {
                padding: 6px 10px;
                font-size: 0.75rem;
                min-height: 34px;
            }
            
            .price-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* 针对iPhone SE等小屏幕手机 */
        @media (max-width: 375px) {
            .time-input-group input[type="datetime-local"] {
                font-size: 13px !important;
                padding: 9px 11px !important;
                min-height: 42px !important;
            }
            
            .time-btn-small {
                padding: 5px 8px;
                font-size: 0.7rem;
                min-height: 32px;
            }
            
            .btn {
                padding: 10px 14px;
                font-size: 0.85rem;
                min-height: 40px;
            }
        }
        
        /* 针对大屏幕优化 */
        @media (min-width: 768px) {
            .container {
                max-width: 680px;
            }
            
            .time-btn-group {
                flex-wrap: nowrap;
            }
            
            .time-btn-small {
                flex: none;
                min-width: 80px;
            }
        }
        
        /* 保持原样... */
        /* 以下是原有的CSS代码，为了简洁我只展示了需要修改的部分 */
        
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p style="margin-top: 16px; color: var(--text-gray); font-size: 0.9rem;">加载中...</p>
    </div>
    
    <div class="container">
        <header>
            <h1>
                <span class="club-name">枫枫电竞</span>
                <i class="fas fa-gamepad" style="color: var(--primary-color); font-size: 1.2rem;"></i>
            </h1>
            <p class="subtitle">专业计时计费系统</p>
            
            <div class="current-time">
                当前时间: <span id="current-time">--:--:--</span>
            </div>
        </header>
        
        <!-- 标签页 -->
        <div class="mobile-tabs">
            <button class="tab-btn active" id="tab-new">
                <i class="fas fa-plus-circle"></i> 新建订单
            </button>
            <button class="tab-btn" id="tab-pending">
                <i class="fas fa-history"></i> 待结束订单
                <span class="order-count" id="pending-count">0</span>
            </button>
        </div>
        
        <!-- 新建订单卡片 -->
        <div class="card" id="new-order-card">
            <h2 class="card-title"><i class="fas fa-calculator"></i> 新建计时订单</h2>
            
            <div class="input-group">
                <label><i class="fas fa-money-bill-wave"></i> 每小时单价 <span class="optional">(可选)</span></label>
                <div class="price-buttons" id="price-buttons">
                    <button class="price-btn" data-price="55">55</button>
                    <button class="price-btn" data-price="60">60</button>
                    <button class="price-btn" data-price="65">65</button>
                    <button class="price-btn" data-price="70">70</button>
                    <button class="price-btn" data-price="75">75</button>
                    <button class="price-btn" data-price="80">80</button>
                    <button class="price-btn" data-price="90">90</button>
                    <button class="price-btn" data-price="100">100</button>
                </div>
                <input type="number" id="price-per-hour" min="0" step="1" placeholder="或输入其他单价" inputmode="decimal">
            </div>
            
            <div class="input-group">
                <label for="companion-name"><i class="fas fa-user"></i> 陪玩名称 <span class="optional">(可选)</span></label>
                <input type="text" id="companion-name" placeholder="请输入陪玩名称">
            </div>
            
            <div class="input-group">
                <label for="boss-name"><i class="fas fa-crown"></i> 老板名称 <span class="optional">(可选)</span></label>
                <input type="text" id="boss-name" placeholder="请输入老板名称">
            </div>
            
            <!-- 优化后的开始时间部分 -->
            <div class="input-group">
                <label for="start-time"><i class="fas fa-play-circle"></i> 开始时间 <span class="required">*</span></label>
                <div class="time-input-group">
                    <input type="datetime-local" id="start-time">
                </div>
                <div class="time-btn-group">
                    <button id="set-start-now-btn" class="time-btn-small">
                        <i class="fas fa-clock"></i> 设为当前
                    </button>
                    <button id="set-start-1h-ago-btn" class="time-btn-small">
                        <i class="fas fa-backward"></i> 1小时前
                    </button>
                    <button id="set-start-30m-ago-btn" class="time-btn-small">
                        <i class="fas fa-backward"></i> 30分钟前
                    </button>
                </div>
            </div>
            
            <!-- 优化后的结束时间部分 -->
            <div class="input-group">
                <label for="end-time"><i class="fas fa-stop-circle"></i> 结束时间 <span class="optional">(可选)</span></label>
                <div class="time-input-group">
                    <input type="datetime-local" id="end-time">
                </div>
                <div class="time-btn-group">
                    <button id="set-end-now-btn" class="time-btn-small">
                        <i class="fas fa-clock"></i> 设为当前
                    </button>
                    <button id="set-end-1h-later-btn" class="time-btn-small">
                        <i class="fas fa-forward"></i> 1小时后
                    </button>
                    <button id="set-end-30m-later-btn" class="time-btn-small">
                        <i class="fas fa-forward"></i> 30分钟后
                    </button>
                </div>
            </div>
            
            <div class="button-group">
                <button id="add-to-pending-btn" class="btn btn-add"><i class="fas fa-plus-circle"></i> 添加订单</button>
                <button id="calculate-time-btn" class="btn btn-time"><i class="fas fa-clock"></i> 计算时长</button>
                <button id="calculate-cost-btn" class="btn btn-primary"><i class="fas fa-calculator"></i> 计算费用</button>
                <button id="reset-btn" class="btn btn-secondary"><i class="fas fa-redo"></i> 重置</button>
            </div>
            
            <div id="time-results" class="results" style="display:none;">
                <h3><i class="fas fa-clock"></i> 时长计算结果</h3>
                <div class="result-item">
                    <span>实际时长:</span>
                    <span class="result-value" id="time-actual">--</span>
                </div>
                <div class="result-item">
                    <span>计费时长:</span>
                    <span class="result-value" id="time-billable">--</span>
                </div>
            </div>
            
            <div id="cost-results" class="results" style="display:none;">
                <h3><i class="fas fa-file-invoice-dollar"></i> 费用计算结果</h3>
                <div class="result-item">
                    <span>总费用:</span>
                    <span class="result-value" id="cost-total">--</span>
                </div>
            </div>
        </div>
        
        <!-- 其余HTML代码保持不变... -->
        
    </div>
    
    <script>
        // ============ 精简版代码 ============
        
        // 修复页面加载偏移
        document.body.style.opacity = '0';
        
        // 显示加载动画
        document.getElementById('loading').style.display = 'flex';
        
        // DOM元素缓存
        const DOM = {
            currentTimeEl: document.getElementById('current-time'),
            pricePerHourEl: document.getElementById('price-per-hour'),
            companionNameEl: document.getElementById('companion-name'),
            bossNameEl: document.getElementById('boss-name'),
            startTimeEl: document.getElementById('start-time'),
            endTimeEl: document.getElementById('end-time'),
            // 新的按钮元素
            setStartNowBtn: document.getElementById('set-start-now-btn'),
            setStart1hAgoBtn: document.getElementById('set-start-1h-ago-btn'),
            setStart30mAgoBtn: document.getElementById('set-start-30m-ago-btn'),
            setEndNowBtn: document.getElementById('set-end-now-btn'),
            setEnd1hLaterBtn: document.getElementById('set-end-1h-later-btn'),
            setEnd30mLaterBtn: document.getElementById('set-end-30m-later-btn'),
            // 其他元素保持不变...
            addToPendingBtn: document.getElementById('add-to-pending-btn'),
            calculateTimeBtn: document.getElementById('calculate-time-btn'),
            calculateCostBtn: document.getElementById('calculate-cost-btn'),
            resetBtn: document.getElementById('reset-btn'),
            timeResults: document.getElementById('time-results'),
            costResults: document.getElementById('cost-results'),
            pendingOrdersContainer: document.getElementById('pending-orders-container'),
            noOrdersEl: document.getElementById('no-orders'),
            priceButtons: document.querySelectorAll('#price-buttons .price-btn'),
            pendingCountEl: document.getElementById('pending-count'),
            loadingEl: document.getElementById('loading')
        };
        
        // 全局变量
        let pendingOrders = [];
        let selectedPrice = null;
        
        // 精确计算金额
        function calculateExactAmount(billableHours, pricePerHour) {
            if (!billableHours || !pricePerHour) return 0;
            return Math.round(billableHours * pricePerHour * 100) / 100;
        }
        
        // 加载和保存数据
        function loadFromLocalStorage() {
            try {
                const savedOrders = localStorage.getItem('fengfengPendingOrders');
                pendingOrders = savedOrders ? JSON.parse(savedOrders) : [];
                console.log(`加载了 ${pendingOrders.length} 个订单`);
            } catch (error) {
                console.error('加载数据时出错:', error);
                pendingOrders = [];
            }
        }
        
        function saveToLocalStorage() {
            try {
                localStorage.setItem('fengfengPendingOrders', JSON.stringify(pendingOrders));
            } catch (error) {
                console.error('保存数据时出错:', error);
                showToast('保存失败', 'error');
            }
        }
        
        // 更新时间显示
        function updateCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            DOM.currentTimeEl.textContent = `${hours}:${minutes}:${seconds}`;
        }
        
        // 格式化日期时间
        function formatDateTimeForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }
        
        // 初始化时间输入
        function initializeTimes() {
            const now = new Date();
            
            // 默认开始时间为当前时间
            DOM.startTimeEl.value = formatDateTimeForInput(now);
            
            // 结束时间留空
            DOM.endTimeEl.value = '';
            
            // 优化移动端显示
            setTimeout(() => {
                DOM.startTimeEl.style.fontSize = '15px';
                DOM.endTimeEl.style.fontSize = '15px';
            }, 100);
        }
        
        // 时间计算函数
        function calculateBillableHours(minutes) {
            if (minutes <= 15) return 0;
            if (minutes <= 44) return 0.5;
            return 1;
        }
        
        function calculateTimeDifference(startTime, endTime = null) {
            const start = new Date(startTime);
            const end = endTime ? new Date(endTime) : new Date();
            
            const diffMs = end - start;
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            
            if (diffMinutes < 0) {
                return { error: "结束时间不能早于开始时间" };
            }
            
            const hours = Math.floor(diffMinutes / 60);
            const remainingMinutes = diffMinutes % 60;
            
            let billableHours = hours;
            billableHours += calculateBillableHours(remainingMinutes);
            
            const durationText = `${hours}小时${remainingMinutes}分钟`;
            const billableText = `${billableHours}小时`;
            
            return {
                actualDuration: durationText,
                billableHours: billableText,
                billableHoursNum: billableHours,
                totalMinutes: diffMinutes,
                hours: hours,
                minutes: remainingMinutes
            };
        }
        
        // 显示时长结果
        function displayTimeResults() {
            if (!DOM.startTimeEl.value) {
                showToast('请填写开始时间', 'warning');
                return;
            }
            
            const result = calculateTimeDifference(DOM.startTimeEl.value, DOM.endTimeEl.value || null);
            
            if (result.error) {
                showToast(result.error, 'error');
                return;
            }
            
            document.getElementById('time-actual').textContent = result.actualDuration;
            document.getElementById('time-billable').textContent = result.billableHours;
            
            DOM.timeResults.style.display = 'block';
            DOM.costResults.style.display = 'none';
        }
        
        // 显示费用结果
        function displayCostResults() {
            if (!DOM.startTimeEl.value) {
                showToast('请填写开始时间', 'warning');
                return;
            }
            
            const pricePerHour = selectedPrice || parseFloat(DOM.pricePerHourEl.value);
            
            if (!pricePerHour || pricePerHour <= 0) {
                showToast('请填写有效的单价', 'error');
                return;
            }
            
            const result = calculateTimeDifference(DOM.startTimeEl.value, DOM.endTimeEl.value || null);
            
            if (result.error) {
                showToast(result.error, 'error');
                return;
            }
            
            const totalCost = calculateExactAmount(result.billableHoursNum, pricePerHour);
            document.getElementById('cost-total').textContent = `${totalCost.toFixed(2)}元`;
            
            DOM.costResults.style.display = 'block';
            DOM.timeResults.style.display = 'none';
        }
        
        // 时间按钮事件处理
        DOM.setStartNowBtn.addEventListener('click', function() {
            const now = new Date();
            DOM.startTimeEl.value = formatDateTimeForInput(now);
            showToast('开始时间已设置为当前时间', 'info');
        });
        
        DOM.setStart1hAgoBtn.addEventListener('click', function() {
            const now = new Date();
            const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
            DOM.startTimeEl.value = formatDateTimeForInput(oneHourAgo);
            showToast('开始时间已设置为1小时前', 'info');
        });
        
        DOM.setStart30mAgoBtn.addEventListener('click', function() {
            const now = new Date();
            const thirtyMinutesAgo = new Date(now.getTime() - 30 * 60 * 1000);
            DOM.startTimeEl.value = formatDateTimeForInput(thirtyMinutesAgo);
            showToast('开始时间已设置为30分钟前', 'info');
        });
        
        DOM.setEndNowBtn.addEventListener('click', function() {
            const now = new Date();
            DOM.endTimeEl.value = formatDateTimeForInput(now);
            showToast('结束时间已设置为当前时间', 'info');
        });
        
        DOM.setEnd1hLaterBtn.addEventListener('click', function() {
            const now = new Date();
            const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);
            DOM.endTimeEl.value = formatDateTimeForInput(oneHourLater);
            showToast('结束时间已设置为1小时后', 'info');
        });
        
        DOM.setEnd30mLaterBtn.addEventListener('click', function() {
            const now = new Date();
            const thirtyMinutesLater = new Date(now.getTime() + 30 * 60 * 1000);
            DOM.endTimeEl.value = formatDateTimeForInput(thirtyMinutesLater);
            showToast('结束时间已设置为30分钟后', 'info');
        });
        
        // 主要按钮事件
        DOM.calculateTimeBtn.addEventListener('click', displayTimeResults);
        DOM.calculateCostBtn.addEventListener('click', displayCostResults);
        
        DOM.addToPendingBtn.addEventListener('click', function() {
            if (!DOM.startTimeEl.value) {
                showToast('请填写开始时间', 'warning');
                return;
            }
            
            const pricePerHour = selectedPrice || parseFloat(DOM.pricePerHourEl.value) || 0;
            const companionName = DOM.companionNameEl.value || '未填写';
            const bossName = DOM.bossNameEl.value || '散客';
            const startTime = DOM.startTimeEl.value;
            const endTime = DOM.endTimeEl.value || null;
            
            if (endTime) {
                const start = new Date(startTime);
                const end = new Date(endTime);
                
                if (end <= start) {
                    showToast('结束时间不能早于开始时间', 'error');
                    return;
                }
            }
            
            const order = {
                id: Date.now(),
                pricePerHour: pricePerHour,
                companionName: companionName,
                bossName: bossName,
                startTime: startTime,
                endTime: endTime,
                status: endTime ? 'completed' : 'pending',
                createdAt: new Date().toISOString()
            };
            
            pendingOrders.push(order);
            saveToLocalStorage();
            
            // 重置表单
            DOM.pricePerHourEl.value = '';
            DOM.companionNameEl.value = '';
            DOM.bossNameEl.value = '';
            initializeTimes();
            DOM.timeResults.style.display = 'none';
            DOM.costResults.style.display = 'none';
            
            DOM.priceButtons.forEach(btn => btn.classList.remove('selected'));
            selectedPrice = null;
            
            showToast('订单已添加', 'success');
        });
        
        // 重置表单
        DOM.resetBtn.addEventListener('click', function() {
            DOM.pricePerHourEl.value = '';
            DOM.companionNameEl.value = '';
            DOM.bossNameEl.value = '';
            initializeTimes();
            DOM.timeResults.style.display = 'none';
            DOM.costResults.style.display = 'none';
            
            DOM.priceButtons.forEach(btn => btn.classList.remove('selected'));
            selectedPrice = null;
            
            showToast('表单已重置', 'info');
        });
        
        // 价格按钮事件
        DOM.priceButtons.forEach(button => {
            button.addEventListener('click', function() {
                DOM.priceButtons.forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
                selectedPrice = parseFloat(this.dataset.price);
                DOM.pricePerHourEl.value = selectedPrice;
            });
        });
        
        // 手动输入价格时清除按钮选择
        DOM.pricePerHourEl.addEventListener('input', function() {
            if (this.value && parseFloat(this.value) !== selectedPrice) {
                DOM.priceButtons.forEach(btn => btn.classList.remove('selected'));
                selectedPrice = null;
            }
        });
        
        // 显示提示消息
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? 'rgba(64, 192, 87, 0.95)' : 
                           type === 'error' ? 'rgba(255, 107, 107, 0.95)' : 
                           type === 'warning' ? 'rgba(255, 204, 0, 0.95)' : 'rgba(77, 171, 247, 0.95)'};
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                z-index: 9999;
                font-weight: 500;
                font-size: 0.85rem;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }
        
        // 添加CSS动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { top: -50px; opacity: 0; }
                to { top: 20px; opacity: 1; }
            }
            @keyframes slideOut {
                from { top: 20px; opacity: 1; }
                to { top: -50px; opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // 初始化
        function init() {
            // 隐藏加载动画
            setTimeout(() => {
                DOM.loadingEl.classList.add('hidden');
                setTimeout(() => {
                    DOM.loadingEl.style.display = 'none';
                    document.body.style.opacity = '1';
                    document.body.style.transition = 'opacity 0.3s ease';
                }, 300);
            }, 500);
            
            // 更新时间显示
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // 从localStorage加载数据
            loadFromLocalStorage();
            
            // 初始化时间输入
            initializeTimes();
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
