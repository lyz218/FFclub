<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ«æ«ç”µç«</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ®</text></svg>">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ®</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        /* ç²¾ç®€é«˜çº§é£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-color: #ff3366;
            --secondary-color: #4dabf7;
            --success-color: #40c057;
            --warning-color: #ffcc00;
            --bg-dark: #0a0a0f;
            --bg-card: rgba(20, 20, 35, 0.95);
            --text-light: #f5f5f7;
            --text-gray: #8a8a9c;
            --border-color: rgba(255, 255, 255, 0.08);
            --shadow-color: rgba(0, 0, 0, 0.3);
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-dark) 0%, #121225 100%);
            color: var(--text-light);
            min-height: 100vh;
            padding: 12px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 14px; /* ç¼©å°æ•´ä½“å­—ä½“ */
            line-height: 1.5;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        /* ç²¾ç®€çš„å¤´éƒ¨ */
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 0;
            position: relative;
        }
        
        h1 {
            color: var(--text-light);
            font-size: 1.4rem; /* ç¼©å°æ ‡é¢˜ */
            font-weight: 600;
            letter-spacing: -0.3px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .club-name {
            color: var(--primary-color);
            font-weight: 700;
        }
        
        .subtitle {
            color: var(--text-gray);
            font-size: 0.8rem; /* ç¼©å°å‰¯æ ‡é¢˜ */
            opacity: 0.8;
        }
        
        .current-time {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 8px 12px;
            margin: 12px auto;
            width: fit-content;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }
        
        .current-time span {
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        /* ä¼˜åŒ–çš„æ ‡ç­¾é¡µ */
        .mobile-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 3px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px 8px;
            border: none;
            background: transparent;
            color: var(--text-gray);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-height: 36px;
        }
        
        .tab-btn.active {
            background: rgba(255, 51, 102, 0.15);
            color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(255, 51, 102, 0.2);
        }
        
        .order-count {
            background: var(--primary-color);
            color: white;
            font-size: 0.7rem;
            padding: 1px 5px;
            border-radius: 10px;
            margin-left: 4px;
        }
        
        /* ç²¾ç®€çš„å¡ç‰‡è®¾è®¡ */
        .card {
            background: var(--bg-card);
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 8px 24px var(--shadow-color);
            border: 1px solid var(--border-color);
            margin-bottom: 16px;
            backdrop-filter: blur(20px);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            color: var(--secondary-color);
            font-size: 1rem; /* ç¼©å°æ ‡é¢˜ */
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }
        
        .card-title i {
            margin-right: 8px;
            font-size: 0.9rem;
        }
        
        /* ç²¾ç®€çš„è¡¨å•æ§ä»¶ */
        .input-group {
            margin-bottom: 14px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-light);
            font-weight: 500;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .optional {
            color: var(--text-gray);
            font-weight: normal;
            font-size: 0.75rem;
            margin-left: 4px;
        }
        
        .required {
            color: var(--primary-color);
            font-size: 0.8rem;
        }
        
        input, select {
            width: 100%;
            padding: 11px 14px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 0.9rem;
            transition: all 0.2s;
            -webkit-appearance: none;
            appearance: none;
        }
        
        /* ç‰¹åˆ«ä¼˜åŒ–æ—¶é—´è¾“å…¥æ¡† */
        input[type="datetime-local"] {
            font-size: 16px !important; /* é˜²æ­¢iOS Safariè‡ªåŠ¨ç¼©æ”¾ */
            min-height: 44px !important; /* æœ€å°è§¦æ‘¸åŒºåŸŸå°ºå¯¸ */
            padding: 12px 14px !important;
            line-height: 1.4 !important;
            color-scheme: dark; /* å‘Šè¯‰æµè§ˆå™¨è¿™æ˜¯æ·±è‰²ä¸»é¢˜è¾“å…¥ */
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(77, 171, 247, 0.15);
            background: rgba(77, 171, 247, 0.05);
        }
        
        input[type="datetime-local"]:focus {
            border-color: var(--secondary-color) !important;
            box-shadow: 0 0 0 3px rgba(77, 171, 247, 0.25) !important;
            outline: none !important;
        }
        
        /* ç²¾ç®€çš„ä»·æ ¼æŒ‰é’® */
        .price-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 7px;
            margin-bottom: 10px;
        }
        
        .price-btn {
            padding: 9px 5px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-height: 36px;
        }
        
        .price-btn:hover, .price-btn:active {
            background: rgba(77, 171, 247, 0.1);
            border-color: var(--secondary-color);
        }
        
        .price-btn.selected {
            background: rgba(77, 171, 247, 0.15);
            border-color: var(--secondary-color);
            color: var(--secondary-color);
            box-shadow: 0 2px 8px rgba(77, 171, 247, 0.2);
        }
        
        /* ç²¾ç®€çš„æ—¶é—´è¾“å…¥ç»„ */
        .time-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
            position: relative;
        }
        
        .time-input-group input {
            flex: 1;
            min-width: 0;
        }
        
        .time-input-group input[type="datetime-local"] {
            flex: 1;
            min-width: 0;
            font-size: 16px; /* ç¡®ä¿å­—ä½“è¶³å¤Ÿå¤§ */
            padding: 12px 14px;
            min-height: 44px;
            line-height: 1.4;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%238a8a9c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 20px;
            padding-right: 40px; /* ä¸ºå³ä¾§å›¾æ ‡ç•™å‡ºç©ºé—´ */
        }
        
        .time-input-group .btn-small {
            min-width: 70px;
            padding: 12px 10px;
            font-size: 0.85rem;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ç²¾ç®€çš„æŒ‰é’®è®¾è®¡ */
        .btn {
            padding: 11px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            margin-bottom: 8px;
            min-height: 42px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #ff5588);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 51, 102, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.06);
            color: white;
            border: 1px solid var(--border-color);
        }
        
        .btn-add {
            background: linear-gradient(135deg, var(--success-color), #52cc67);
            color: white;
            box-shadow: 0 4px 12px rgba(64, 192, 87, 0.3);
        }
        
        .btn-time {
            background: linear-gradient(135deg, var(--secondary-color), #5ab3ff);
            color: white;
            box-shadow: 0 4px 12px rgba(77, 171, 247, 0.3);
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 0.8rem;
            min-height: 36px;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        /* ç»“æœåŒºåŸŸ */
        .results {
            margin-top: 18px;
            background: rgba(0, 0, 0, 0.2);
            padding: 14px;
            border-radius: 10px;
            border-left: 3px solid var(--primary-color);
        }
        
        .results h3 {
            color: var(--warning-color);
            margin-bottom: 10px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
            font-size: 0.9rem;
        }
        
        .result-value {
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        /* ä¼˜åŒ–çš„å¾…ç»“æŸé¡µé¢å¸ƒå±€ - å–æ¶ˆè€æ¿åˆ†ç»„ï¼Œæ”¹ä¸ºæ‰å¹³åˆ—è¡¨ */
        .pending-orders {
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            margin-top: 12px;
            -webkit-overflow-scrolling: touch;
        }
        
        .order-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-gray);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background: rgba(77, 171, 247, 0.15);
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }
        
        .order-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            border-left: 3px solid var(--warning-color);
            transition: all 0.2s;
        }
        
        .order-item.completed {
            border-left-color: var(--success-color);
            opacity: 0.9;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .order-title {
            font-weight: 600;
            color: var(--warning-color);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .order-item.completed .order-title {
            color: var(--success-color);
        }
        
        .order-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: rgba(255, 204, 0, 0.15);
            color: var(--warning-color);
            border: 1px solid rgba(255, 204, 0, 0.2);
        }
        
        .status-completed {
            background-color: rgba(64, 192, 87, 0.15);
            color: var(--success-color);
            border: 1px solid rgba(64, 192, 87, 0.2);
        }
        
        /* ç®€åŒ–çš„è®¢å•è¯¦æƒ…å¸ƒå±€ */
        .order-info {
            margin-bottom: 12px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }
        
        .info-label {
            color: var(--text-gray);
            min-width: 60px;
        }
        
        .info-value {
            color: var(--text-light);
            font-weight: 500;
            text-align: right;
            flex: 1;
        }
        
        /* ç²¾ç®€çš„æ“ä½œæŒ‰é’® */
        .order-actions {
            display: flex;
            gap: 6px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            min-width: 0;
            justify-content: center;
        }
        
        .edit-btn {
            background-color: rgba(77, 171, 247, 0.15);
            color: var(--secondary-color);
            border: 1px solid rgba(77, 171, 247, 0.2);
        }
        
        .complete-btn {
            background-color: rgba(64, 192, 87, 0.15);
            color: var(--success-color);
            border: 1px solid rgba(64, 192, 87, 0.2);
        }
        
        .delete-btn {
            background-color: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.2);
        }
        
        /* å¤åˆ¶åŒºåŸŸä¼˜åŒ– */
        .copy-area {
            margin-top: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .copy-text {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.8rem;
            line-height: 1.4;
            white-space: pre-wrap;
            color: var(--text-light);
            margin-bottom: 8px;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        
        .copy-btn {
            width: 100%;
            padding: 8px;
            background: rgba(77, 171, 247, 0.1);
            border: 1px solid var(--secondary-color);
            color: var(--secondary-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .copy-btn.copied {
            background: rgba(64, 192, 87, 0.15);
            border-color: var(--success-color);
            color: var(--success-color);
        }
        
        /* è€æ¿ç»Ÿè®¡ä¼˜åŒ– */
        .boss-statistics {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
        }
        
        .boss-statistics h3 {
            color: var(--warning-color);
            margin-bottom: 12px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .boss-stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
            font-size: 0.9rem;
        }
        
        .boss-name {
            color: var(--text-light);
            cursor: pointer;
            transition: color 0.2s;
            font-weight: 500;
        }
        
        .boss-name:hover {
            color: var(--secondary-color);
        }
        
        .boss-total {
            font-weight: 600;
            color: var(--success-color);
        }
        
        .boss-total-amount {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1rem;
        }
        
        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-gray);
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.2;
        }
        
        .empty-state p {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .empty-state .subtext {
            font-size: 0.8rem;
            opacity: 0.6;
        }
        
        /* åº•éƒ¨ */
        footer {
            text-align: center;
            margin-top: 25px;
            color: var(--text-gray);
            font-size: 0.75rem;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            opacity: 0.7;
        }
        
        /* æ¨¡æ€æ¡†ä¼˜åŒ– */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal.show {
            display: flex;
            opacity: 1;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            -webkit-overflow-scrolling: touch;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            color: var(--warning-color);
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 1.3rem;
            cursor: pointer;
            padding: 4px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .close-btn:hover {
            opacity: 1;
        }
        
        /* æ¨¡æ€æ¡†ä¸­çš„æ—¶é—´è¾“å…¥æ¡† */
        .modal-content input[type="datetime-local"] {
            font-size: 16px !important;
            min-height: 44px !important;
            padding: 12px 14px !important;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%238a8a9c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 20px;
            padding-right: 40px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .card {
                padding: 16px;
            }
            
            .price-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .btn {
                padding: 10px 14px;
                font-size: 0.85rem;
                min-height: 40px;
            }
            
            .button-group {
                gap: 6px;
            }
            
            .time-input-group .btn-small {
                min-width: 70px;
                padding: 12px 10px;
                font-size: 0.85rem;
            }
            
            .order-item {
                padding: 12px;
            }
            
            .order-actions {
                gap: 5px;
            }
            
            .action-btn {
                padding: 5px 8px;
                font-size: 0.7rem;
            }
            
            /* æ‰‹æœºç«¯æ—¶é—´è¾“å…¥æ¡†ä¼˜åŒ– */
            input[type="datetime-local"],
            .time-input-group input[type="datetime-local"] {
                font-size: 15px !important;
                padding: 10px 12px !important;
                min-height: 42px !important;
            }
            
            input[type="datetime-local"]::placeholder {
                font-size: 14px;
                color: var(--text-gray);
                opacity: 0.7;
            }
        }
        
        /* é’ˆå¯¹å°å±å¹•æ‰‹æœºçš„è¿›ä¸€æ­¥ä¼˜åŒ– */
        @media (max-width: 360px) {
            .time-input-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .time-input-group input[type="datetime-local"] {
                width: 100%;
            }
            
            .time-input-group .btn-small {
                width: 100%;
                min-width: 0;
            }
        }
        
        /* å¢å¼ºå“åº”å¼è®¾è®¡ */
        @media (max-width: 414px) {
            .input-group {
                margin-bottom: 16px;
            }
            
            .time-input-group {
                flex-wrap: wrap;
            }
            
            .time-input-group input[type="datetime-local"] {
                min-height: 46px;
                padding: 13px 14px;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 680px;
            }
            
            .button-group {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .btn {
                width: auto;
                flex: 1;
            }
            
            .time-input-group .btn-small {
                min-width: 70px;
            }
            
            .order-actions {
                justify-content: flex-end;
            }
            
            .action-btn {
                flex: none;
                min-width: 80px;
            }
        }
        
        /* ä¿®å¤iOS Safariçš„æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨é—®é¢˜ */
        @media screen and (max-width: 767px) {
            input[type="datetime-local"] {
                -webkit-appearance: none;
                appearance: none;
                display: block;
                width: 100%;
                box-sizing: border-box;
            }
        }
        
        /* å¢åŠ æ—¶é—´è¾“å…¥æ¡†åœ¨ç§»åŠ¨ç«¯çš„å¯è¯»æ€§ */
        @media (hover: none) and (pointer: coarse) {
            input[type="datetime-local"] {
                font-size: 16px; /* ç¡®ä¿åœ¨è§¦æ‘¸è®¾å¤‡ä¸Šè¶³å¤Ÿå¤§ */
                padding-top: 14px;
                padding-bottom: 14px;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            transition: opacity 0.3s ease;
            opacity: 1;
        }
        
        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card, .order-item, .boss-statistics {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }
        
        /* è®¢å•ç­›é€‰å™¨ */
        .boss-filter {
            margin-bottom: 16px;
        }
        
        .boss-select {
            width: 100%;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 0.9rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238a8a9c' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 40px;
        }
        
        /* å¿«é€Ÿæ“ä½œæ  */
        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
        }
        
        .quick-action-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--secondary-color);
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .status-pending .status-indicator {
            background-color: var(--warning-color);
            box-shadow: 0 0 8px var(--warning-color);
        }
        
        .status-completed .status-indicator {
            background-color: var(--success-color);
            box-shadow: 0 0 8px var(--success-color);
        }
    </style>
</head>
<body>
    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p style="margin-top: 16px; color: var(--text-gray); font-size: 0.9rem;">åŠ è½½ä¸­...</p>
    </div>
    
    <div class="container">
        <header>
            <h1>
                <span class="club-name">æ«æ«ç”µç«</span>
                <i class="fas fa-gamepad" style="color: var(--primary-color); font-size: 1.2rem;"></i>
            </h1>
            <p class="subtitle">ä¸“ä¸šè®¡æ—¶è®¡è´¹ç³»ç»Ÿ</p>
            
            <div class="current-time">
                å½“å‰æ—¶é—´: <span id="current-time">--:--:--</span>
            </div>
        </header>
        
        <!-- æ ‡ç­¾é¡µ -->
        <div class="mobile-tabs">
            <button class="tab-btn active" id="tab-new">
                <i class="fas fa-plus-circle"></i> æ–°å»ºè®¢å•
            </button>
            <button class="tab-btn" id="tab-pending">
                <i class="fas fa-history"></i> å¾…ç»“æŸè®¢å•
                <span class="order-count" id="pending-count">0</span>
            </button>
        </div>
        
        <!-- æ–°å»ºè®¢å•å¡ç‰‡ -->
        <div class="card" id="new-order-card">
            <h2 class="card-title"><i class="fas fa-calculator"></i> æ–°å»ºè®¡æ—¶è®¢å•</h2>
            
            <div class="input-group">
                <label><i class="fas fa-money-bill-wave"></i> æ¯å°æ—¶å•ä»· <span class="optional">(å¯é€‰)</span></label>
                <div class="price-buttons" id="price-buttons">
                    <button class="price-btn" data-price="55">55</button>
                    <button class="price-btn" data-price="60">60</button>
                    <button class="price-btn" data-price="65">65</button>
                    <button class="price-btn" data-price="70">70</button>
                    <button class="price-btn" data-price="75">75</button>
                    <button class="price-btn" data-price="80">80</button>
                    <button class="price-btn" data-price="90">90</button>
                    <button class="price-btn" data-price="100">100</button>
                </div>
                <input type="number" id="price-per-hour" min="0" step="1" placeholder="æˆ–è¾“å…¥å…¶ä»–å•ä»·" inputmode="decimal">
            </div>
            
            <div class="input-group">
                <label for="companion-name"><i class="fas fa-user"></i> é™ªç©åç§° <span class="optional">(å¯é€‰)</span></label>
                <input type="text" id="companion-name" placeholder="è¯·è¾“å…¥é™ªç©åç§°">
            </div>
            
            <div class="input-group">
                <label for="boss-name"><i class="fas fa-crown"></i> è€æ¿åç§° <span class="optional">(å¯é€‰)</span></label>
                <input type="text" id="boss-name" placeholder="è¯·è¾“å…¥è€æ¿åç§°">
            </div>
            
            <div class="input-group">
                <label for="start-time"><i class="fas fa-play-circle"></i> å¼€å§‹æ—¶é—´ <span class="required">*</span></label>
                <div class="time-input-group">
                    <input type="datetime-local" id="start-time">
                    <button id="set-now-btn" class="btn btn-secondary btn-small">ç°åœ¨</button>
                </div>
            </div>
            
            <div class="input-group">
                <label for="end-time"><i class="fas fa-stop-circle"></i> ç»“æŸæ—¶é—´ <span class="optional">(å¯é€‰)</span></label>
                <div class="time-input-group">
                    <input type="datetime-local" id="end-time">
                    <button id="set-current-btn" class="btn btn-secondary btn-small">å½“å‰</button>
                </div>
            </div>
            
            <div class="button-group">
                <button id="add-to-pending-btn" class="btn btn-add"><i class="fas fa-plus-circle"></i> æ·»åŠ è®¢å•</button>
                <button id="calculate-time-btn" class="btn btn-time"><i class="fas fa-clock"></i> è®¡ç®—æ—¶é•¿</button>
                <button id="calculate-cost-btn" class="btn btn-primary"><i class="fas fa-calculator"></i> è®¡ç®—è´¹ç”¨</button>
                <button id="reset-btn" class="btn btn-secondary"><i class="fas fa-redo"></i> é‡ç½®</button>
            </div>
            
            <div id="time-results" class="results" style="display:none;">
                <h3><i class="fas fa-clock"></i> æ—¶é•¿è®¡ç®—ç»“æœ</h3>
                <div class="result-item">
                    <span>å®é™…æ—¶é•¿:</span>
                    <span class="result-value" id="time-actual">--</span>
                </div>
                <div class="result-item">
                    <span>è®¡è´¹æ—¶é•¿:</span>
                    <span class="result-value" id="time-billable">--</span>
                </div>
            </div>
            
            <div id="cost-results" class="results" style="display:none;">
                <h3><i class="fas fa-file-invoice-dollar"></i> è´¹ç”¨è®¡ç®—ç»“æœ</h3>
                <div class="result-item">
                    <span>æ€»è´¹ç”¨:</span>
                    <span class="result-value" id="cost-total">--</span>
                </div>
            </div>
        </div>
        
        <!-- å¾…ç»“æŸè®¢å•å¡ç‰‡ - ä¼˜åŒ–å¸ƒå±€ -->
        <div class="card" id="pending-orders-card" style="display:none;">
            <h2 class="card-title"><i class="fas fa-history"></i> å¾…ç»“æŸè®¢å•</h2>
            
            <!-- å¿«é€Ÿæ“ä½œæ  -->
            <div class="quick-actions">
                <button class="quick-action-btn" id="filter-all">
                    <i class="fas fa-list"></i> å…¨éƒ¨
                </button>
                <button class="quick-action-btn" id="filter-pending">
                    <i class="fas fa-clock"></i> è¿›è¡Œä¸­
                </button>
                <button class="quick-action-btn" id="filter-completed">
                    <i class="fas fa-check-circle"></i> å·²å®Œæˆ
                </button>
            </div>
            
            <!-- è€æ¿ç­›é€‰ -->
            <div class="boss-filter">
                <select class="boss-select" id="boss-filter-select">
                    <option value="all">å…¨éƒ¨è€æ¿</option>
                    <option value="æ•£å®¢">æ•£å®¢</option>
                    <!-- åŠ¨æ€æ·»åŠ è€æ¿é€‰é¡¹ -->
                </select>
            </div>
            
            <!-- è®¢å•åˆ—è¡¨ -->
            <div class="pending-orders" id="pending-orders-container">
                <div class="empty-state" id="no-orders">
                    <i class="fas fa-clipboard-list"></i>
                    <p>æš‚æ— å¾…ç»“æŸè®¢å•</p>
                    <p class="subtext">æ·»åŠ æ–°çš„è®¢å•åï¼Œå°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                </div>
            </div>
            
            <!-- è€æ¿æ¶ˆè´¹ç»Ÿè®¡ -->
            <div id="boss-statistics-container">
                <!-- åŠ¨æ€ç”Ÿæˆç»Ÿè®¡ -->
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button id="clear-all-btn" class="btn btn-secondary"><i class="fas fa-trash-alt"></i> æ¸…é™¤æ‰€æœ‰</button>
                <button id="export-btn" class="btn btn-secondary"><i class="fas fa-file-export"></i> å¯¼å‡ºæ•°æ®</button>
            </div>
        </div>
    </div>
    
    <!-- ç¼–è¾‘è®¢å•æ¨¡æ€æ¡† -->
    <div class="modal" id="edit-order-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> ç¼–è¾‘è®¢å•</h3>
                <button class="close-btn" id="close-edit-modal">&times;</button>
            </div>
            
            <div class="input-group">
                <label><i class="fas fa-money-bill-wave"></i> æ¯å°æ—¶å•ä»·</label>
                <div class="price-buttons" id="edit-price-buttons">
                    <button class="price-btn" data-price="55">55</button>
                    <button class="price-btn" data-price="60">60</button>
                    <button class="price-btn" data-price="65">65</button>
                    <button class="price-btn" data-price="70">70</button>
                    <button class="price-btn" data-price="75">75</button>
                    <button class="price-btn" data-price="80">80</button>
                    <button class="price-btn" data-price="90">90</button>
                    <button class="price-btn" data-price="100">100</button>
                </div>
                <input type="number" id="edit-price-per-hour" min="0" step="1" placeholder="è¾“å…¥å•ä»·" inputmode="decimal">
            </div>
            
            <div class="input-group">
                <label for="edit-companion-name"><i class="fas fa-user"></i> é™ªç©åç§°</label>
                <input type="text" id="edit-companion-name" placeholder="è¯·è¾“å…¥é™ªç©åç§°">
            </div>
            
            <div class="input-group">
                <label for="edit-boss-name"><i class="fas fa-crown"></i> è€æ¿åç§°</label>
                <input type="text" id="edit-boss-name" placeholder="è¯·è¾“å…¥è€æ¿åç§°">
            </div>
            
            <div class="input-group">
                <label for="edit-start-time"><i class="fas fa-play-circle"></i> å¼€å§‹æ—¶é—´</label>
                <input type="datetime-local" id="edit-start-time">
            </div>
            
            <div class="input-group">
                <label for="edit-end-time"><i class="fas fa-stop-circle"></i> ç»“æŸæ—¶é—´</label>
                <div class="time-input-group">
                    <input type="datetime-local" id="edit-end-time">
                    <button id="edit-set-current-btn" class="btn btn-secondary btn-small">è®¾ä¸ºå½“å‰</button>
                </div>
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button id="edit-complete-btn" class="btn btn-add"><i class="fas fa-check-circle"></i> ç»“æŸè®¢å•</button>
                <button id="save-edit-btn" class="btn btn-primary"><i class="fas fa-save"></i> ä¿å­˜ä¿®æ”¹</button>
                <button id="cancel-edit-btn" class="btn btn-secondary"><i class="fas fa-times"></i> å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- è€æ¿è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="boss-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user-tie"></i> <span id="boss-detail-name">è€æ¿è¯¦æƒ…</span></h3>
                <button class="close-btn" id="close-boss-detail-modal">&times;</button>
            </div>
            
            <div class="result-item">
                <span>è®¢å•æ€»æ•°:</span>
                <span class="result-value" id="boss-total-orders">0</span>
            </div>
            <div class="result-item">
                <span>å·²å®Œæˆ:</span>
                <span class="result-value" id="boss-completed-orders">0</span>
            </div>
            <div class="result-item">
                <span>è¿›è¡Œä¸­:</span>
                <span class="result-value" id="boss-pending-orders">0</span>
            </div>
            <div class="result-item">
                <span>æ€»æ¶ˆè´¹:</span>
                <span class="result-value" id="boss-total-cost">0.00å…ƒ</span>
            </div>
            
            <h4 style="margin-top: 20px; margin-bottom: 10px; color: var(--secondary-color); font-size: 0.95rem;">
                <i class="fas fa-list"></i> è®¢å•åˆ—è¡¨
            </h4>
            
            <div class="pending-orders" id="boss-orders-list" style="max-height: 300px;">
                <!-- åŠ¨æ€ç”Ÿæˆè€æ¿è®¢å• -->
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button id="close-boss-detail-btn" class="btn btn-secondary">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <footer>
        <p>æ«æ«ç”µç« &copy; 2023 | ä¸“ä¸šè®¡æ—¶è®¡è´¹ç³»ç»Ÿ</p>
        <p style="margin-top: 5px; font-size: 0.7rem;">æ•°æ®ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­</p>
    </footer>
    
    <script>
        // ============ ç²¾ç®€ç‰ˆä»£ç  ============
        
        // ä¿®å¤é¡µé¢åŠ è½½åç§»
        document.body.style.opacity = '0';
        
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        document.getElementById('loading').style.display = 'flex';
        
        // DOMå…ƒç´ ç¼“å­˜
        const DOM = {
            currentTimeEl: document.getElementById('current-time'),
            pricePerHourEl: document.getElementById('price-per-hour'),
            companionNameEl: document.getElementById('companion-name'),
            bossNameEl: document.getElementById('boss-name'),
            startTimeEl: document.getElementById('start-time'),
            endTimeEl: document.getElementById('end-time'),
            setNowBtn: document.getElementById('set-now-btn'),
            setCurrentBtn: document.getElementById('set-current-btn'),
            addToPendingBtn: document.getElementById('add-to-pending-btn'),
            calculateTimeBtn: document.getElementById('calculate-time-btn'),
            calculateCostBtn: document.getElementById('calculate-cost-btn'),
            resetBtn: document.getElementById('reset-btn'),
            timeResults: document.getElementById('time-results'),
            costResults: document.getElementById('cost-results'),
            pendingOrdersContainer: document.getElementById('pending-orders-container'),
            noOrdersEl: document.getElementById('no-orders'),
            priceButtons: document.querySelectorAll('#price-buttons .price-btn'),
            pendingCountEl: document.getElementById('pending-count'),
            bossStatisticsContainer: document.getElementById('boss-statistics-container'),
            bossFilterSelect: document.getElementById('boss-filter-select'),
            filterAllBtn: document.getElementById('filter-all'),
            filterPendingBtn: document.getElementById('filter-pending'),
            filterCompletedBtn: document.getElementById('filter-completed'),
            tabNewBtn: document.getElementById('tab-new'),
            tabPendingBtn: document.getElementById('tab-pending'),
            newOrderCard: document.getElementById('new-order-card'),
            pendingOrdersCard: document.getElementById('pending-orders-card'),
            editOrderModal: document.getElementById('edit-order-modal'),
            closeEditModalBtn: document.getElementById('close-edit-modal'),
            cancelEditBtn: document.getElementById('cancel-edit-btn'),
            saveEditBtn: document.getElementById('save-edit-btn'),
            editCompleteBtn: document.getElementById('edit-complete-btn'),
            editPricePerHourEl: document.getElementById('edit-price-per-hour'),
            editCompanionNameEl: document.getElementById('edit-companion-name'),
            editBossNameEl: document.getElementById('edit-boss-name'),
            editStartTimeEl: document.getElementById('edit-start-time'),
            editEndTimeEl: document.getElementById('edit-end-time'),
            editSetCurrentBtn: document.getElementById('edit-set-current-btn'),
            editPriceButtons: document.querySelectorAll('#edit-price-buttons .price-btn'),
            loadingEl: document.getElementById('loading'),
            clearAllBtn: document.getElementById('clear-all-btn'),
            exportBtn: document.getElementById('export-btn')
        };
        
        // å…¨å±€å˜é‡
        let pendingOrders = [];
        let editingOrderId = null;
        let selectedPrice = null;
        let editSelectedPrice = null;
        let currentFilter = 'all'; // all, pending, completed
        let currentBossFilter = 'all';
        
        // ç²¾ç¡®è®¡ç®—é‡‘é¢
        function calculateExactAmount(billableHours, pricePerHour) {
            if (!billableHours || !pricePerHour) return 0;
            return Math.round(billableHours * pricePerHour * 100) / 100;
        }
        
        // åŠ è½½å’Œä¿å­˜æ•°æ®
        function loadFromLocalStorage() {
            try {
                const savedOrders = localStorage.getItem('fengfengPendingOrders');
                pendingOrders = savedOrders ? JSON.parse(savedOrders) : [];
                console.log(`åŠ è½½äº† ${pendingOrders.length} ä¸ªè®¢å•`);
            } catch (error) {
                console.error('åŠ è½½æ•°æ®æ—¶å‡ºé”™:', error);
                pendingOrders = [];
            }
        }
        
        function saveToLocalStorage() {
            try {
                localStorage.setItem('fengfengPendingOrders', JSON.stringify(pendingOrders));
            } catch (error) {
                console.error('ä¿å­˜æ•°æ®æ—¶å‡ºé”™:', error);
                showToast('ä¿å­˜å¤±è´¥', 'error');
            }
        }
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        DOM.tabNewBtn.addEventListener('click', () => switchTab('new'));
        DOM.tabPendingBtn.addEventListener('click', () => switchTab('pending'));
        
        function switchTab(tab) {
            if (tab === 'new') {
                DOM.tabNewBtn.classList.add('active');
                DOM.tabPendingBtn.classList.remove('active');
                DOM.newOrderCard.style.display = 'block';
                DOM.pendingOrdersCard.style.display = 'none';
            } else {
                DOM.tabPendingBtn.classList.add('active');
                DOM.tabNewBtn.classList.remove('active');
                DOM.newOrderCard.style.display = 'none';
                DOM.pendingOrdersCard.style.display = 'block';
                updateBossFilterOptions();
                updatePendingOrdersDisplay();
                updateBossStatistics();
            }
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            DOM.currentTimeEl.textContent = `${hours}:${minutes}:${seconds}`;
        }
        
        // åˆå§‹åŒ–æ—¶é—´
        function initializeTimes() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            const datetimeLocalNow = `${year}-${month}-${day}T${hours}:${minutes}`;
            
            if (!DOM.startTimeEl.value) {
                DOM.startTimeEl.value = datetimeLocalNow;
            }
            
            if (!DOM.endTimeEl.value) {
                DOM.endTimeEl.value = '';
            }
        }
        
        // æ—¶é—´è®¡ç®—å‡½æ•°
        function calculateBillableHours(minutes) {
            if (minutes <= 15) return 0;
            if (minutes <= 44) return 0.5;
            return 1;
        }
        
        function calculateTimeDifference(startTime, endTime = null) {
            const start = new Date(startTime);
            const end = endTime ? new Date(endTime) : new Date();
            
            const diffMs = end - start;
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            
            if (diffMinutes < 0) {
                return { error: "ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´" };
            }
            
            const hours = Math.floor(diffMinutes / 60);
            const remainingMinutes = diffMinutes % 60;
            
            let billableHours = hours;
            billableHours += calculateBillableHours(remainingMinutes);
            
            const durationText = `${hours}å°æ—¶${remainingMinutes}åˆ†é’Ÿ`;
            const billableText = `${billableHours}å°æ—¶`;
            
            return {
                actualDuration: durationText,
                billableHours: billableText,
                billableHoursNum: billableHours,
                totalMinutes: diffMinutes,
                hours: hours,
                minutes: remainingMinutes
            };
        }
        
        function calculateOrderCost(order) {
            const timeResult = calculateTimeDifference(order.startTime, order.endTime);
            if (timeResult.error) return 0;
            return calculateExactAmount(timeResult.billableHoursNum, (order.pricePerHour || 0));
        }
        
        // æ˜¾ç¤ºæ—¶é•¿ç»“æœ
        function displayTimeResults() {
            if (!DOM.startTimeEl.value) {
                showToast('è¯·å¡«å†™å¼€å§‹æ—¶é—´', 'warning');
                return;
            }
            
            const result = calculateTimeDifference(DOM.startTimeEl.value, DOM.endTimeEl.value || null);
            
            if (result.error) {
                showToast(result.error, 'error');
                return;
            }
            
            document.getElementById('time-actual').textContent = result.actualDuration;
            document.getElementById('time-billable').textContent = result.billableHours;
            
            DOM.timeResults.style.display = 'block';
            DOM.costResults.style.display = 'none';
        }
        
        // æ˜¾ç¤ºè´¹ç”¨ç»“æœ
        function displayCostResults() {
            if (!DOM.startTimeEl.value) {
                showToast('è¯·å¡«å†™å¼€å§‹æ—¶é—´', 'warning');
                return;
            }
            
            const pricePerHour = selectedPrice || parseFloat(DOM.pricePerHourEl.value);
            
            if (!pricePerHour || pricePerHour <= 0) {
                showToast('è¯·å¡«å†™æœ‰æ•ˆçš„å•ä»·', 'error');
                return;
            }
            
            const result = calculateTimeDifference(DOM.startTimeEl.value, DOM.endTimeEl.value || null);
            
            if (result.error) {
                showToast(result.error, 'error');
                return;
            }
            
            const totalCost = calculateExactAmount(result.billableHoursNum, pricePerHour);
            document.getElementById('cost-total').textContent = `${totalCost.toFixed(2)}å…ƒ`;
            
            DOM.costResults.style.display = 'block';
            DOM.timeResults.style.display = 'none';
        }
        
        // æ·»åŠ åˆ°å¾…ç»“æŸè®¢å•
        function addToPendingOrders() {
            if (!DOM.startTimeEl.value) {
                showToast('è¯·å¡«å†™å¼€å§‹æ—¶é—´', 'warning');
                return;
            }
            
            const pricePerHour = selectedPrice || parseFloat(DOM.pricePerHourEl.value) || 0;
            const companionName = DOM.companionNameEl.value || 'æœªå¡«å†™';
            const bossName = DOM.bossNameEl.value || 'æ•£å®¢';
            const startTime = DOM.startTimeEl.value;
            const endTime = DOM.endTimeEl.value || null;
            
            if (endTime) {
                const start = new Date(startTime);
                const end = new Date(endTime);
                
                if (end <= start) {
                    showToast('ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´', 'error');
                    return;
                }
            }
            
            const order = {
                id: Date.now(),
                pricePerHour: pricePerHour,
                companionName: companionName,
                bossName: bossName,
                startTime: startTime,
                endTime: endTime,
                status: endTime ? 'completed' : 'pending',
                createdAt: new Date().toISOString()
            };
            
            pendingOrders.push(order);
            saveToLocalStorage();
            
            updatePendingOrdersDisplay();
            updateBossStatistics();
            
            // é‡ç½®è¡¨å•
            DOM.pricePerHourEl.value = '';
            DOM.companionNameEl.value = '';
            DOM.bossNameEl.value = '';
            initializeTimes();
            DOM.timeResults.style.display = 'none';
            DOM.costResults.style.display = 'none';
            
            DOM.priceButtons.forEach(btn => btn.classList.remove('selected'));
            selectedPrice = null;
            
            showToast('è®¢å•å·²æ·»åŠ ', 'success');
        }
        
        // æ›´æ–°è€æ¿ç­›é€‰é€‰é¡¹
        function updateBossFilterOptions() {
            const bossNames = [...new Set(pendingOrders.map(order => order.bossName || 'æ•£å®¢'))].sort();
            
            // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆé™¤äº†"å…¨éƒ¨è€æ¿"ï¼‰
            while (DOM.bossFilterSelect.options.length > 1) {
                DOM.bossFilterSelect.remove(1);
            }
            
            // æ·»åŠ è€æ¿é€‰é¡¹
            bossNames.forEach(bossName => {
                const option = document.createElement('option');
                option.value = bossName;
                option.textContent = bossName;
                DOM.bossFilterSelect.appendChild(option);
            });
        }
        
        // æ›´æ–°å¾…ç»“æŸè®¢å•æ˜¾ç¤º
        function updatePendingOrdersDisplay() {
            DOM.pendingOrdersContainer.innerHTML = '';
            
            // æ›´æ–°è®¢å•æ•°é‡
            const pendingCount = pendingOrders.filter(order => !order.endTime).length;
            DOM.pendingCountEl.textContent = pendingCount > 0 ? pendingCount : '';
            
            // ç­›é€‰è®¢å•
            let filteredOrders = pendingOrders;
            
            // æŒ‰çŠ¶æ€ç­›é€‰
            if (currentFilter === 'pending') {
                filteredOrders = filteredOrders.filter(order => !order.endTime);
            } else if (currentFilter === 'completed') {
                filteredOrders = filteredOrders.filter(order => order.endTime);
            }
            
            // æŒ‰è€æ¿ç­›é€‰
            if (currentBossFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => 
                    (order.bossName || 'æ•£å®¢') === currentBossFilter
                );
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åº
            filteredOrders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filteredOrders.length === 0) {
                let message = '';
                if (currentFilter === 'pending') {
                    message = 'æš‚æ— è¿›è¡Œä¸­è®¢å•';
                } else if (currentFilter === 'completed') {
                    message = 'æš‚æ— å·²å®Œæˆè®¢å•';
                } else if (currentBossFilter !== 'all') {
                    message = `è¯¥è€æ¿æš‚æ— ${currentFilter === 'all' ? '' : currentFilter === 'pending' ? 'è¿›è¡Œä¸­' : 'å·²å®Œæˆ'}è®¢å•`;
                } else {
                    message = 'æš‚æ— å¾…ç»“æŸè®¢å•';
                }
                
                DOM.pendingOrdersContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>${message}</p>
                        <p class="subtext">${currentFilter === 'all' && currentBossFilter === 'all' ? 'æ·»åŠ æ–°çš„è®¢å•åï¼Œå°†åœ¨è¿™é‡Œæ˜¾ç¤º' : 'å°è¯•åˆ‡æ¢ç­›é€‰æ¡ä»¶'}</p>
                    </div>
                `;
                return;
            }
            
            // åˆ›å»ºè®¢å•å…ƒç´ 
            filteredOrders.forEach(order => {
                const orderElement = createOrderElement(order);
                DOM.pendingOrdersContainer.appendChild(orderElement);
            });
        }
        
        // ç”Ÿæˆå°ç¨‹åºæ–‡æœ¬
        function generateMiniProgramText(order, timeResult, totalCost) {
            const startDate = new Date(order.startTime);
            const year = startDate.getFullYear();
            const month = String(startDate.getMonth() + 1).padStart(2, '0');
            const day = String(startDate.getDate()).padStart(2, '0');
            const hours = String(startDate.getHours()).padStart(2, '0');
            const minutes = String(startDate.getMinutes()).padStart(2, '0');
            
            let miniProgramText = '';
            miniProgramText += 'æ¥å•ç¾¤ï¼šæ«æ«ç”µç«æ´¾å•ç¾¤\n';
            miniProgramText += `é¡¹ç›®ï¼šPUBG-${order.pricePerHour || 0}\n`;
            miniProgramText += `è€æ¿ï¼š${order.bossName || 'æ•£å®¢'}\n`;
            miniProgramText += 'æ‰€å±äººï¼š\n';
            miniProgramText += 'æ•°é‡ï¼š1\n';
            miniProgramText += `é‡‘é¢ï¼š${totalCost.toFixed(2)}\n`;
            miniProgramText += 'æ¥å¾…ï¼šxs\n';  // å›ºå®šä¸º"xs"
            miniProgramText += `æ¥å•æ—¶é—´ï¼š${year}-${month}-${day}-${hours}:${minutes}`;
            
            return miniProgramText;
        }
        
        // åˆ›å»ºè®¢å•å…ƒç´ 
        function createOrderElement(order) {
            const isCompleted = order.endTime !== null;
            const timeResult = calculateTimeDifference(order.startTime, order.endTime);
            
            let durationText = 'è¿›è¡Œä¸­';
            let billableText = 'å¾…è®¡ç®—';
            let costText = 'å¾…è®¡ç®—';
            let totalCost = 0;
            
            if (!timeResult.error && isCompleted) {
                durationText = timeResult.actualDuration;
                billableText = timeResult.billableHours;
                
                if (order.pricePerHour > 0) {
                    totalCost = calculateExactAmount(timeResult.billableHoursNum, order.pricePerHour);
                    costText = `${totalCost.toFixed(2)}å…ƒ`;
                }
            } else if (!timeResult.error && !isCompleted) {
                const currentResult = calculateTimeDifference(order.startTime);
                durationText = `${currentResult.actualDuration} (è¿›è¡Œä¸­)`;
                billableText = currentResult.billableHours;
                
                if (order.pricePerHour > 0) {
                    totalCost = calculateExactAmount(currentResult.billableHoursNum, order.pricePerHour);
                    costText = `${totalCost.toFixed(2)}å…ƒ (é¢„ä¼°)`;
                }
            }
            
            // ç”ŸæˆæŠ¥å•æ–‡æœ¬
            const copyText = generateCopyText(order, timeResult, isCompleted);
            
            const orderDiv = document.createElement('div');
            orderDiv.className = `order-item ${isCompleted ? 'completed' : ''}`;
            orderDiv.setAttribute('data-id', order.id);
            orderDiv.setAttribute('data-boss', order.bossName || 'æ•£å®¢');
            orderDiv.setAttribute('data-status', isCompleted ? 'completed' : 'pending');
            
            orderDiv.innerHTML = `
                <div class="order-header">
                    <div class="order-title">
                        <span class="status-indicator"></span>
                        è®¢å• #${order.id.toString().slice(-6)}
                    </div>
                    <div class="order-status ${isCompleted ? 'status-completed' : 'status-pending'}">
                        ${isCompleted ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}
                    </div>
                </div>
                
                <div class="order-info">
                    <div class="info-row">
                        <span class="info-label">é™ªç©:</span>
                        <span class="info-value">${order.companionName}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">è€æ¿:</span>
                        <span class="info-value">${order.bossName || 'æ•£å®¢'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å¼€å§‹:</span>
                        <span class="info-value">${formatDateTimeForDisplay(new Date(order.startTime))}</span>
                    </div>
                    ${order.endTime ? `
                        <div class="info-row">
                            <span class="info-label">ç»“æŸ:</span>
                            <span class="info-value">${formatDateTimeForDisplay(new Date(order.endTime))}</span>
                        </div>
                    ` : ''}
                    <div class="info-row">
                        <span class="info-label">æ—¶é•¿:</span>
                        <span class="info-value">${durationText}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">è®¡è´¹:</span>
                        <span class="info-value">${billableText}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">å•ä»·:</span>
                        <span class="info-value">${order.pricePerHour > 0 ? `${order.pricePerHour}å…ƒ/å°æ—¶` : 'æœªè®¾ç½®'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">è´¹ç”¨:</span>
                        <span class="info-value">${costText}</span>
                    </div>
                </div>
                
                <div class="order-actions">
                    <button class="action-btn edit-btn" onclick="editOrder(${order.id})">
                        <i class="fas fa-edit"></i> ç¼–è¾‘
                    </button>
                    ${!isCompleted ? `
                        <button class="action-btn complete-btn" onclick="completeOrder(${order.id})">
                            <i class="fas fa-check-circle"></i> ç»“æŸ
                        </button>
                    ` : ''}
                    <button class="action-btn delete-btn" onclick="deleteOrder(${order.id})">
                        <i class="fas fa-trash"></i> åˆ é™¤
                    </button>
                </div>
                
                <div class="copy-area">
                    <div class="copy-text">${copyText}</div>
                    <button class="copy-btn" onclick="copyTextToClipboard(${order.id})">
                        <i class="fas fa-copy"></i> å¤åˆ¶æŠ¥å•æ–‡æœ¬
                    </button>
                </div>
                
                <div class="copy-area" style="margin-top: 8px;">
                    <button class="copy-btn" onclick="copyMiniProgramText(${order.id})">
                        <i class="fas fa-mobile-alt"></i> å¤åˆ¶å°ç¨‹åºæ–‡æœ¬
                    </button>
                </div>
            `;
            
            return orderDiv;
        }
        
        // ç”ŸæˆæŠ¥å•æ–‡æœ¬
        function generateCopyText(order, timeResult, isCompleted) {
            const startDate = new Date(order.startTime);
            const month = startDate.getMonth() + 1;
            const day = startDate.getDate();
            
            const startHours = String(startDate.getHours()).padStart(2, '0');
            const startMinutes = String(startDate.getMinutes()).padStart(2, '0');
            
            let copyText = `${month}/${day}\n`;
            copyText += `å¼€å§‹æ—¶é—´:${startHours}:${startMinutes}  ${order.bossName || 'æ•£å®¢'}\n`;
            
            if (isCompleted && order.endTime && !timeResult.error) {
                const endDate = new Date(order.endTime);
                const endHours = String(endDate.getHours()).padStart(2, '0');
                const endMinutes = String(endDate.getMinutes()).padStart(2, '0');
                
                const billableHours = timeResult.billableHoursNum;
                const formattedHours = billableHours % 1 === 0 ? billableHours.toFixed(0) : billableHours.toFixed(1);
                
                copyText += `ç»“æŸæ—¶é—´:${endHours}:${endMinutes} ${formattedHours}h ${order.pricePerHour}/h å·²æŠ¥å¤‡`;
            }
            
            return copyText;
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        function formatDateTimeForDisplay(date) {
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${month}-${day} ${hours}:${minutes}`;
        }
        
        function formatDateTimeForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }
        
        // å¤åˆ¶åŠŸèƒ½
        window.copyTextToClipboard = async function(orderId) {
            try {
                const orderElement = document.querySelector(`.order-item[data-id="${orderId}"]`);
                if (!orderElement) {
                    showToast('æœªæ‰¾åˆ°è®¢å•', 'error');
                    return;
                }
                
                const copyTextElement = orderElement.querySelector('.copy-text');
                if (!copyTextElement) {
                    showToast('æœªæ‰¾åˆ°å¤åˆ¶æ–‡æœ¬', 'error');
                    return;
                }
                
                const textToCopy = copyTextElement.textContent.trim();
                const copyBtn = orderElement.querySelector('.copy-btn');
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(textToCopy);
                    copyBtn.classList.add('copied');
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                    setTimeout(() => {
                        copyBtn.classList.remove('copied');
                        copyBtn.innerHTML = '<i class="fas fa-copy"></i> å¤åˆ¶æŠ¥å•æ–‡æœ¬';
                    }, 2000);
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } else {
                    fallbackCopyText(textToCopy, copyBtn);
                }
            } catch (error) {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                showToast('å¤åˆ¶å¤±è´¥', 'error');
            }
        };
        
        // å¤åˆ¶å°ç¨‹åºæ–‡æœ¬
        window.copyMiniProgramText = async function(orderId) {
            try {
                const orderIndex = pendingOrders.findIndex(order => order.id === orderId);
                if (orderIndex === -1) {
                    showToast('æœªæ‰¾åˆ°è®¢å•', 'error');
                    return;
                }
                
                const order = pendingOrders[orderIndex];
                const timeResult = calculateTimeDifference(order.startTime, order.endTime);
                let totalCost = 0;
                
                if (!timeResult.error) {
                    totalCost = calculateExactAmount(timeResult.billableHoursNum, order.pricePerHour || 0);
                }
                
                // ç”Ÿæˆå°ç¨‹åºæ–‡æœ¬
                const textToCopy = generateMiniProgramText(order, timeResult, totalCost);
                
                // æ‰¾åˆ°å¯¹åº”çš„å¤åˆ¶æŒ‰é’®
                const orderElement = document.querySelector(`.order-item[data-id="${orderId}"]`);
                const copyBtn = orderElement ? orderElement.querySelectorAll('.copy-btn')[1] : null;
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(textToCopy);
                    if (copyBtn) {
                        copyBtn.classList.add('copied');
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                        setTimeout(() => {
                            copyBtn.classList.remove('copied');
                            copyBtn.innerHTML = '<i class="fas fa-mobile-alt"></i> å¤åˆ¶å°ç¨‹åºæ–‡æœ¬';
                        }, 2000);
                    }
                    showToast('å°ç¨‹åºæ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } else {
                    // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
                    fallbackCopyTextMiniProgram(textToCopy, copyBtn);
                }
            } catch (error) {
                console.error('å¤åˆ¶å°ç¨‹åºæ–‡æœ¬å¤±è´¥:', error);
                showToast('å¤åˆ¶å¤±è´¥', 'error');
            }
        };
        
        function fallbackCopyText(text, copyBtn) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    copyBtn.classList.add('copied');
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                    setTimeout(() => {
                        copyBtn.classList.remove('copied');
                        copyBtn.innerHTML = '<i class="fas fa-copy"></i> å¤åˆ¶æŠ¥å•æ–‡æœ¬';
                    }, 2000);
                    showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } else {
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶', 'error');
                }
            } catch (error) {
                showToast('å¤åˆ¶å¤±è´¥', 'error');
            }
        }
        
        function fallbackCopyTextMiniProgram(text, copyBtn) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    if (copyBtn) {
                        copyBtn.classList.add('copied');
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                        setTimeout(() => {
                            copyBtn.classList.remove('copied');
                            copyBtn.innerHTML = '<i class="fas fa-mobile-alt"></i> å¤åˆ¶å°ç¨‹åºæ–‡æœ¬';
                        }, 2000);
                    }
                    showToast('å°ç¨‹åºæ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } else {
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶', 'error');
                }
            } catch (error) {
                showToast('å¤åˆ¶å¤±è´¥', 'error');
            }
        }
        
        // è®¢å•æ“ä½œ
        window.editOrder = function(id) {
            const orderIndex = pendingOrders.findIndex(order => order.id === id);
            if (orderIndex === -1) return;
            
            const order = pendingOrders[orderIndex];
            editingOrderId = id;
            editSelectedPrice = order.pricePerHour || null;
            
            DOM.editPricePerHourEl.value = order.pricePerHour || '';
            DOM.editCompanionNameEl.value = order.companionName;
            DOM.editBossNameEl.value = order.bossName;
            DOM.editStartTimeEl.value = formatDateTimeForInput(new Date(order.startTime));
            DOM.editEndTimeEl.value = order.endTime ? formatDateTimeForInput(new Date(order.endTime)) : '';
            
            DOM.editPriceButtons.forEach(btn => {
                if (parseFloat(btn.dataset.price) === order.pricePerHour) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
            
            DOM.editOrderModal.classList.add('show');
        };
        
        window.completeOrder = function(id) {
            const orderIndex = pendingOrders.findIndex(order => order.id === id);
            if (orderIndex === -1) return;
            
            if (confirm('ç¡®å®šè¦ç»“æŸè¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                const now = new Date();
                const datetimeLocal = formatDateTimeForInput(now);
                
                pendingOrders[orderIndex].endTime = datetimeLocal;
                pendingOrders[orderIndex].status = 'completed';
                saveToLocalStorage();
                updatePendingOrdersDisplay();
                updateBossStatistics();
                showToast('è®¢å•å·²ç»“æŸ', 'success');
            }
        };
        
        window.deleteOrder = function(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                pendingOrders = pendingOrders.filter(order => order.id !== id);
                saveToLocalStorage();
                updatePendingOrdersDisplay();
                updateBossStatistics();
                showToast('è®¢å•å·²åˆ é™¤', 'success');
            }
        };
        
        // ä¿å­˜ç¼–è¾‘
        DOM.saveEditBtn.addEventListener('click', function() {
            if (!editingOrderId) return;
            
            const orderIndex = pendingOrders.findIndex(order => order.id === editingOrderId);
            if (orderIndex === -1) return;
            
            const pricePerHour = editSelectedPrice || parseFloat(DOM.editPricePerHourEl.value) || 0;
            const companionName = DOM.editCompanionNameEl.value || 'æœªå¡«å†™';
            const bossName = DOM.editBossNameEl.value || 'æ•£å®¢';
            const startTime = DOM.editStartTimeEl.value;
            const endTime = DOM.editEndTimeEl.value || null;
            
            if (endTime) {
                const start = new Date(startTime);
                const end = new Date(endTime);
                
                if (end <= start) {
                    showToast('ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´', 'error');
                    return;
                }
            }
            
            pendingOrders[orderIndex].pricePerHour = pricePerHour;
            pendingOrders[orderIndex].companionName = companionName;
            pendingOrders[orderIndex].bossName = bossName;
            pendingOrders[orderIndex].startTime = startTime;
            pendingOrders[orderIndex].endTime = endTime;
            pendingOrders[orderIndex].status = endTime ? 'completed' : 'pending';
            
            saveToLocalStorage();
            updatePendingOrdersDisplay();
            updateBossStatistics();
            
            DOM.editOrderModal.classList.remove('show');
            editingOrderId = null;
            editSelectedPrice = null;
            
            showToast('è®¢å•å·²æ›´æ–°', 'success');
        });
        
        // åœ¨ç¼–è¾‘ä¸­å®Œæˆè®¢å•
        DOM.editCompleteBtn.addEventListener('click', function() {
            if (!editingOrderId) return;
            
            const orderIndex = pendingOrders.findIndex(order => order.id === editingOrderId);
            if (orderIndex === -1) return;
            
            const pricePerHour = editSelectedPrice || parseFloat(DOM.editPricePerHourEl.value) || 0;
            const companionName = DOM.editCompanionNameEl.value || 'æœªå¡«å†™';
            const bossName = DOM.editBossNameEl.value || 'æ•£å®¢';
            const startTime = DOM.editStartTimeEl.value;
            
            let endTime = DOM.editEndTimeEl.value;
            
            if (!endTime) {
                const now = new Date();
                endTime = formatDateTimeForInput(now);
                DOM.editEndTimeEl.value = endTime;
            }
            
            const start = new Date(startTime);
            const end = new Date(endTime);
            
            if (end <= start) {
                showToast('ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦ç»“æŸè¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                pendingOrders[orderIndex].pricePerHour = pricePerHour;
                pendingOrders[orderIndex].companionName = companionName;
                pendingOrders[orderIndex].bossName = bossName;
                pendingOrders[orderIndex].startTime = startTime;
                pendingOrders[orderIndex].endTime = endTime;
                pendingOrders[orderIndex].status = 'completed';
                
                saveToLocalStorage();
                updatePendingOrdersDisplay();
                updateBossStatistics();
                
                DOM.editOrderModal.classList.remove('show');
                editingOrderId = null;
                editSelectedPrice = null;
                
                showToast('è®¢å•å·²ç»“æŸ', 'success');
            }
        });
        
        // å…³é—­æ¨¡æ€æ¡†
        DOM.closeEditModalBtn.addEventListener('click', () => DOM.editOrderModal.classList.remove('show'));
        DOM.cancelEditBtn.addEventListener('click', () => DOM.editOrderModal.classList.remove('show'));
        DOM.editOrderModal.addEventListener('click', (e) => {
            if (e.target === DOM.editOrderModal) DOM.editOrderModal.classList.remove('show');
        });
        
        // ä»·æ ¼æŒ‰é’®äº‹ä»¶
        DOM.priceButtons.forEach(button => {
            button.addEventListener('click', function() {
                DOM.priceButtons.forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
                selectedPrice = parseFloat(this.dataset.price);
                DOM.pricePerHourEl.value = selectedPrice;
            });
        });
        
        DOM.editPriceButtons.forEach(button => {
            button.addEventListener('click', function() {
                DOM.editPriceButtons.forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
                editSelectedPrice = parseFloat(this.dataset.price);
                DOM.editPricePerHourEl.value = editSelectedPrice;
            });
        });
        
        // æ‰‹åŠ¨è¾“å…¥ä»·æ ¼æ—¶æ¸…é™¤æŒ‰é’®é€‰æ‹©
        DOM.pricePerHourEl.addEventListener('input', function() {
            if (this.value && parseFloat(this.value) !== selectedPrice) {
                DOM.priceButtons.forEach(btn => btn.classList.remove('selected'));
                selectedPrice = null;
            }
        });
        
        DOM.editPricePerHourEl.addEventListener('input', function() {
            if (this.value && parseFloat(this.value) !== editSelectedPrice) {
                DOM.editPriceButtons.forEach(btn => btn.classList.remove('selected'));
                editSelectedPrice = null;
            }
        });
        
        // æ—¶é—´è®¾ç½®æŒ‰é’®
        DOM.setNowBtn.addEventListener('click', function() {
            const now = new Date();
            const datetimeLocal = formatDateTimeForInput(now);
            DOM.startTimeEl.value = datetimeLocal;
            DOM.timeResults.style.display = 'none';
            DOM.costResults.style.display = 'none';
        });
        
        DOM.setCurrentBtn.addEventListener('click', function() {
            const now = new Date();
            const datetimeLocal = formatDateTimeForInput(now);
            DOM.endTimeEl.value = datetimeLocal;
            DOM.timeResults.style.display = 'none';
            DOM.costResults.style.display = 'none';
        });
        
        DOM.editSetCurrentBtn.addEventListener('click', function() {
            const now = new Date();
            const datetimeLocal = formatDateTimeForInput(now);
            DOM.editEndTimeEl.value = datetimeLocal;
        });
        
        // ç­›é€‰æŒ‰é’®äº‹ä»¶
        DOM.filterAllBtn.addEventListener('click', () => {
            currentFilter = 'all';
            updateFilterButtons();
            updatePendingOrdersDisplay();
        });
        
        DOM.filterPendingBtn.addEventListener('click', () => {
            currentFilter = 'pending';
            updateFilterButtons();
            updatePendingOrdersDisplay();
        });
        
        DOM.filterCompletedBtn.addEventListener('click', () => {
            currentFilter = 'completed';
            updateFilterButtons();
            updatePendingOrdersDisplay();
        });
        
        DOM.bossFilterSelect.addEventListener('change', function() {
            currentBossFilter = this.value;
            updatePendingOrdersDisplay();
        });
        
        function updateFilterButtons() {
            [DOM.filterAllBtn, DOM.filterPendingBtn, DOM.filterCompletedBtn].forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (currentFilter === 'all') DOM.filterAllBtn.classList.add('active');
            else if (currentFilter === 'pending') DOM.filterPendingBtn.classList.add('active');
            else if (currentFilter === 'completed') DOM.filterCompletedBtn.classList.add('active');
        }
        
        // æ›´æ–°è€æ¿æ¶ˆè´¹ç»Ÿè®¡
        function updateBossStatistics() {
            DOM.bossStatisticsContainer.innerHTML = '';
            
            if (pendingOrders.length === 0) {
                return;
            }
            
            // ç»Ÿè®¡æ¯ä¸ªè€æ¿çš„æ¶ˆè´¹æ€»é¢
            const bossStats = {};
            
            pendingOrders.forEach(order => {
                const bossName = order.bossName || 'æ•£å®¢';
                const cost = calculateOrderCost(order);
                
                if (!bossStats[bossName]) {
                    bossStats[bossName] = {
                        total: 0,
                        orderCount: 0,
                        pendingCount: 0
                    };
                }
                
                bossStats[bossName].total += cost;
                bossStats[bossName].orderCount += 1;
                if (!order.endTime) bossStats[bossName].pendingCount += 1;
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æ¶ˆè´¹æ€»é¢é™åºæ’åº
            const bossStatsArray = Object.entries(bossStats)
                .map(([name, stats]) => ({
                    name,
                    total: Math.round(stats.total * 100) / 100,
                    orderCount: stats.orderCount,
                    pendingCount: stats.pendingCount
                }))
                .sort((a, b) => b.total - a.total);
            
            // è®¡ç®—æ‰€æœ‰è€æ¿çš„æ€»æ¶ˆè´¹
            const grandTotal = bossStatsArray.reduce((sum, boss) => sum + boss.total, 0);
            const exactGrandTotal = Math.round(grandTotal * 100) / 100;
            
            // åˆ›å»ºç»Ÿè®¡å¡ç‰‡
            const statsCard = document.createElement('div');
            statsCard.className = 'boss-statistics';
            
            let statsHTML = `
                <h3><i class="fas fa-chart-bar"></i> æ¶ˆè´¹ç»Ÿè®¡</h3>
            `;
            
            if (bossStatsArray.length === 0) {
                statsHTML += `<div class="empty-state" style="padding: 20px;"><p>æš‚æ— æ¶ˆè´¹ç»Ÿè®¡</p></div>`;
            } else {
                // æ˜¾ç¤ºæ¯ä¸ªè€æ¿çš„æ¶ˆè´¹ç»Ÿè®¡
                bossStatsArray.forEach(boss => {
                    statsHTML += `
                        <div class="boss-stat-item">
                            <span class="boss-name" onclick="showBossDetails('${boss.name.replace(/'/g, "\\'")}')">
                                ${boss.name}
                                <small style="color: var(--text-gray); font-weight: normal; margin-left: 4px;">
                                    (${boss.orderCount}å•, ${boss.pendingCount}è¿›è¡Œä¸­)
                                </small>
                            </span>
                            <span class="boss-total">${boss.total.toFixed(2)}å…ƒ</span>
                        </div>
                    `;
                });
                
                // æ˜¾ç¤ºæ€»è®¡
                statsHTML += `
                    <div class="boss-stat-item" style="border-bottom: none; margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--border-color);">
                        <span class="boss-name" style="font-weight: 600;">æ€»è®¡</span>
                        <span class="boss-total-amount">${exactGrandTotal.toFixed(2)}å…ƒ</span>
                    </div>
                `;
            }
            
            statsCard.innerHTML = statsHTML;
            DOM.bossStatisticsContainer.appendChild(statsCard);
        }
        
        // æ˜¾ç¤ºè€æ¿è¯¦æƒ…
        window.showBossDetails = function(bossName) {
            const bossOrders = pendingOrders.filter(order => (order.bossName || 'æ•£å®¢') === bossName);
            
            if (bossOrders.length === 0) {
                showToast('è¯¥è€æ¿æ²¡æœ‰è®¢å•', 'info');
                return;
            }
            
            const totalOrders = bossOrders.length;
            const completedOrders = bossOrders.filter(order => order.endTime).length;
            const pendingOrdersCount = totalOrders - completedOrders;
            
            let totalCost = 0;
            bossOrders.forEach(order => {
                totalCost += calculateOrderCost(order);
            });
            totalCost = Math.round(totalCost * 100) / 100;
            
            // æ›´æ–°æ¨¡æ€æ¡†å†…å®¹
            document.getElementById('boss-detail-name').textContent = bossName;
            document.getElementById('boss-total-orders').textContent = totalOrders;
            document.getElementById('boss-completed-orders').textContent = completedOrders;
            document.getElementById('boss-pending-orders').textContent = pendingOrdersCount;
            document.getElementById('boss-total-cost').textContent = `${totalCost.toFixed(2)}å…ƒ`;
            
            // æ¸…ç©ºå¹¶æ·»åŠ è®¢å•åˆ—è¡¨
            const ordersList = document.getElementById('boss-orders-list');
            ordersList.innerHTML = '';
            
            // æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åº
            const sortedOrders = [...bossOrders].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedOrders.forEach(order => {
                const orderElement = createOrderElement(order);
                ordersList.appendChild(orderElement);
            });
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('boss-detail-modal').classList.add('show');
        };
        
        // å…³é—­è€æ¿è¯¦æƒ…æ¨¡æ€æ¡†
        document.getElementById('close-boss-detail-modal').addEventListener('click', () => {
            document.getElementById('boss-detail-modal').classList.remove('show');
        });
        
        document.getElementById('close-boss-detail-btn').addEventListener('click', () => {
            document.getElementById('boss-detail-modal').classList.remove('show');
        });
        
        document.getElementById('boss-detail-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('boss-detail-modal')) {
                document.getElementById('boss-detail-modal').classList.remove('show');
            }
        });
        
        // æ¸…é™¤æ‰€æœ‰è®¢å•
        DOM.clearAllBtn.addEventListener('click', function() {
            if (pendingOrders.length === 0) {
                showToast('æ²¡æœ‰è®¢å•å¯æ¸…é™¤', 'info');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰è®¢å•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                pendingOrders = [];
                saveToLocalStorage();
                updatePendingOrdersDisplay();
                updateBossStatistics();
                showToast('æ‰€æœ‰è®¢å•å·²æ¸…é™¤', 'success');
            }
        });
        
        // å¯¼å‡ºæ•°æ®
        DOM.exportBtn.addEventListener('click', function() {
            if (pendingOrders.length === 0) {
                showToast('æ²¡æœ‰è®¢å•å¯å¯¼å‡º', 'info');
                return;
            }
            
            const csv = convertOrdersToCSV();
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `æ«æ«ç”µç«è®¢å•_${new Date().toLocaleDateString('zh-CN').replace(/\//g, '-')}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('æ•°æ®å·²å¯¼å‡º', 'success');
        });
        
        function convertOrdersToCSV() {
            let csv = 'è®¢å•ID,é™ªç©åç§°,è€æ¿åç§°,å¼€å§‹æ—¶é—´,ç»“æŸæ—¶é—´,å•ä»·,çŠ¶æ€,åˆ›å»ºæ—¶é—´,è®¡è´¹æ—¶é•¿,æ€»è´¹ç”¨\n';
            
            pendingOrders.forEach(order => {
                const timeResult = calculateTimeDifference(order.startTime, order.endTime);
                const totalCost = calculateOrderCost(order);
                
                csv += `"${order.id}","${order.companionName}","${order.bossName || 'æ•£å®¢'}","${formatDateTimeForDisplay(new Date(order.startTime))}",`;
                csv += `"${order.endTime ? formatDateTimeForDisplay(new Date(order.endTime)) : ''}","${order.pricePerHour}","${order.endTime ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}",`;
                csv += `"${formatDateTimeForDisplay(new Date(order.createdAt))}","${timeResult.billableHours}","${totalCost.toFixed(2)}"\n`;
            });
            
            return csv;
        }
        
        // é‡ç½®è¡¨å•
        DOM.resetBtn.addEventListener('click', function() {
            DOM.pricePerHourEl.value = '';
            DOM.companionNameEl.value = '';
            DOM.bossNameEl.value = '';
            initializeTimes();
            DOM.timeResults.style.display = 'none';
            DOM.costResults.style.display = 'none';
            
            DOM.priceButtons.forEach(btn => btn.classList.remove('selected'));
            selectedPrice = null;
            
            showToast('è¡¨å•å·²é‡ç½®', 'info');
        });
        
        // ä¸»è¦æŒ‰é’®äº‹ä»¶
        DOM.calculateTimeBtn.addEventListener('click', displayTimeResults);
        DOM.calculateCostBtn.addEventListener('click', displayCostResults);
        DOM.addToPendingBtn.addEventListener('click', addToPendingOrders);
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? 'rgba(64, 192, 87, 0.95)' : 
                           type === 'error' ? 'rgba(255, 107, 107, 0.95)' : 
                           type === 'warning' ? 'rgba(255, 204, 0, 0.95)' : 'rgba(77, 171, 247, 0.95)'};
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                z-index: 9999;
                font-weight: 500;
                font-size: 0.85rem;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }
        
        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { top: -50px; opacity: 0; }
                to { top: 20px; opacity: 1; }
            }
            @keyframes slideOut {
                from { top: 20px; opacity: 1; }
                to { top: -50px; opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // åˆå§‹åŒ–
        function init() {
            // éšè—åŠ è½½åŠ¨ç”»
            setTimeout(() => {
                DOM.loadingEl.classList.add('hidden');
                setTimeout(() => {
                    DOM.loadingEl.style.display = 'none';
                    document.body.style.opacity = '1';
                    document.body.style.transition = 'opacity 0.3s ease';
                }, 300);
            }, 500);
            
            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // ä»localStorageåŠ è½½æ•°æ®
            loadFromLocalStorage();
            
            // åˆå§‹åŒ–æ—¶é—´è¾“å…¥
            initializeTimes();
            
            // è®¾ç½®é»˜è®¤ç­›é€‰æŒ‰é’®çŠ¶æ€
            updateFilterButtons();
            
            // æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    loadFromLocalStorage();
                    updatePendingOrdersDisplay();
                    updateBossStatistics();
                }
            });
            
            // æ·»åŠ beforeunloadäº‹ä»¶
            window.addEventListener('beforeunload', saveToLocalStorage);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
